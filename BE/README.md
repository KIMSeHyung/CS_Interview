# Backend

* [SPOF란?](#SPOF란)
* [스케일 업과 스케일 아웃](#스케일-업과-스케일-아웃)
* [로드 밸런서](#로드-밸런서)
* [백엔드 서버가 API 서버와 DB 서버로 구성되어 있을 때, API 서버에 부하가 몰리는 작업의 예시와 DB 서버에 부하가 몰리는 작업의 예시](#API-서버와-DB-서버)
* [Stateful과 Stateless](#Stateful과-Stateless)

<br />
---

## SPOF란

* Single Point of Failure의 준말로, 시스템 구성 요소 중에서 동작하지 않으면 전체 시스템이 중단되는 요소를 말한다.
*  시스템에 SPOF가 존재하는 경우, 해당 지점의 장애가 시스템 전체 장애로 이어지므로, 시스템은 되도록이면 SPOF가 존재하지 않도록 구성되어야 한다.

## 스케일 업과 스케일 아웃

* 스케일 업은 시스템/서버 자체의 성능(스펙)을 높여서 능력을 향상시키며, 수직 스케일이라고도 부른다.
    * 부품을 추가할 수만 있으면 시스템 설계 변경 없이 서비스 사용량을 늘릴 수 있는 장점이 있다.
    * 부품 추가 자체가 어렵고, 시스템이 커질수록 비용이 지수적으로 증가하는 단점이 있다.
* 스케일 아웃은 시스템/서버의 대수를 늘려서 처리 능력을 향상시키며, 수평 스케일이라고도 부른다.
    * 스케일 업 방식보다 더 적은 비용으로 시스템 확장이 가능하며, 여러 대의 시스템에 로드를 적절히 분산해 하나의 시스템에 장애가 발생해도 서비스에 미치는 영향이 없도록 Fault Tolerance를 구현할 수 있는 장점이 있다.
    * 별도의 복잡한 아키텍처 구성을 해야하며, 프로세스나 네트워크 장비가 추가로 필요할 수 있는 단점이 있다. (시스템의 복잡도가 증가한다.)

## 로드 밸런서

* 서버 시스템에서의 로드밸런서는 여러 대의 서버에 균등하게 트래픽을 분산시켜주는 역할을 한다. 즉, 서버나 장비의 부하를 분산하기 위해 사용하는 장비를 흔히 로드 밸런서라고 부른다.
* 로드 밸런서는 일반적으로 4계층 이상에서 동작하며, 가장 많이 쓰이는 분야는 웹 서버의 부하 분산이다.
* 로드 밸런서는 동작하는 계층에 따라 보통 4계층과 7계층으로 나뉜다.
    * L4 로드 밸런싱은 L3의 IP 정보와 L4의 TCP, UDP 정보(특히 IP 주소와 TCP/UDP 포트들)를 기반으로 로드 밸런싱을 수행한다. L4 로드 밸런서는 NLB(Network Load Balancer)라고도 한다.
    * L7 로드 밸런싱은 HTTP나 SMTP같은 애플리케이션 프로토콜 정보를 기반으로 로드 밸런싱을 수행한다. L7 로드 밸런서는 ALB(Application Load Balancer) 라고도 한다.
* 대표적인 로드 밸런싱 알고리즘은 다음과 같다.
    * 클라이언트로부터 받은 요청을 서버마다 균등하게 분배하는 라운드 로빈 방식이 있다.
    * 연결 수가 가장 적은 서버에 요청을 전달하는 최소 연결 방식이 있다.
    * 가장 빠른 응답을 하는 서버에게 요청을 분배하는 Fastest Response Time 방식이 있다.
    * 위 방식들에 가중치를 부여하여 가중치 XX 방식을 구현할 수도 있다.
    * 세션 유지가 필요한 경우 위와 같은 방식으로는 문제가 생길 수 있다. 기존에 클라이언트가 서버 A와 세션을 맺었는데, 다시 로드 밸런서에게 보낸 요청을 로드 밸런서가 서버 B에게 전달하면 서버 A, 클라이언트, 서버 B 모두에게 문제가 생길 수 있다.
    * 위와 같은 문제가 발생하지 않도록 같은 소스 주소의 클라이언트에게는 같은 서버에게 요청을 전달하는 소스 해시 방식이 있다.

## API 서버와 DB 서버

* API 서버에만 부하가 몰리는 작업에는 웹 스크래핑 작업이나 정적 파일 서빙 등이 있다.
* CPU 작업이 주가 되는 MO 게임 서버의 게임 서빙 등도 여기에 포함됩니다.
    * LOL, 배틀그라운드, 스타크래프트
* DB 서버에 부하가 몰리는 작업의 대표는 SNS의 글/댓글이나 카톡방의 대화 처리 등이 있다. 이러한 작업은 API 서버에 들어온 요청을 처리하기도 하지만, 주로 DB서버에 부하를 줍니다. 
    * 일반적으로 생각하는 대부분의 작업이 주로 DB서버에 부하를 준다.

## Stateful과 Stateless

* Stateful 서버는 클라이언트의 정보를 서버에 저장하여 이 전 상태를 기억하는 서버이다.
    * * Stateful 구조에서 API 서버는 User(클라이언트)의 정보를 저장한 채로 동작한다.
* Stateless 서버는 클라이언트의 정보를 저장하지 않아 이 전 상태를 기록하지 않는 서버이다.
    * Stateless 구조에서 API 서버는 비즈니스 로직만 가지게 된다.
    * Stateless 서버의 경우 추가/삭제가 간단하지만, 크고 안정적인 디비/스토리지가 필요하다.
* Stateful 구조보다 Stateless 구조일 경우 DB서버의 중요도가 높다.

---

## 대규모 서비스가 가져야 할 특성

* 확장성(Elastic)
    * 서비스의 가용 용량을 쉽게 늘이고 줄일 수 있어야 한다.
* 장애회복성(Resiliency)
    * 서비스에 장애가 일어났을 때 가능한 수동적 처리 없이 자동 회복해야 한다.
    * 장애 회복성을 위해 SPOF가 없어야 한다. : 모든 부분에서 최소 이중화가 되어야 한다.
* 자동화(AUtomation)
    * 배포부터 장애처리 등 대부분 자동화 되어야 한다.
* 모니터링(Monitoring)
    * 서비스 상태는 항상 모니터링 되어야 한다.